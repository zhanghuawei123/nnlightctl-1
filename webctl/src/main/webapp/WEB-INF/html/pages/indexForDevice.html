<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/nnlightctl/html/css/bootstrap/tether.min.css">
    <link rel="stylesheet" href="/nnlightctl/html/css/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="/nnlightctl/html/css/bootstrap/bootstrap-switch.min.css">
    <link rel="stylesheet" href="/nnlightctl/html/css/bootstrap/bootstrap-datetimepicker.min.css">
    <title>设备调试</title>
</head>
<body>

<div class="container-fluid">
    <div class="row">
        <div class="col-sm-1"><label class="form-control">命令：</label></div>
        <div class="col-sm-8"><textarea class="form-control" id="comandText" rows="3"></textarea></div>
        <div class="col-sm-3"><button type="button" class="btn btn-primary" id="sendCommand">发送命令</button></div>
    </div>

    <br/>

    <!--<div class="row">
        <div class="col-sm-1">
            <label class="form-control">命令返回：</label>
        </div>

        <div class="col-sm-8">
            <textarea class="form-control" id="resultText" rows="3"></textarea>
        </div>
    </div>-->

    <br/>
    <hr/>
    <br/>

    <!-- 灯具调节 -->
    <div class="row">
        <div class="col-sm-1">
            <label class="form-control">灯具灯光调节：</label>
        </div>

        <div class="col-sm-1">
            <input type="text" class="form-control" id="lightPercent">
        </div>

        <div class="col-sm-2">
            <input class="form-control" type="range" min="0" max="100" value="0" step="5" id="lightPercentSlide" />
        </div>

        <div class="col-sm-2">
            <div class="form-group">
                <label for="lightId" class="col-md-3 control-label">单灯id值：</label>
                <div class="input-group col-md-8">
                    <input id="lightId" class="form-control" size="16" type="text" value="" >
                </div>
            </div>
        </div>

        <div class="col-sm-2">
            <button type="button" class="btn btn-primary" id="sendCommandLightAdjust">发送命令</button>
        </div>
    </div>

    <br/>
    <hr/>
    <br/>

    <!-- 重启/复位 -->
    <div class="row">
        <div class="col-sm-3">
            <button type="button" class="btn btn-primary" id="resetBtn">重启/复位</button>
        </div>
    </div>

    <br/>
    <hr/>
    <br/>

    <!-- 设置定时发送参数 -->
    <div class="row">
        <div class="col-sm-1">
            <label class="form-control">定时发送(秒)：</label>
        </div>
        <div class="col-sm-3">
            <input type="text" class="form-control" id="sendPeriod">
        </div>
        <div class="col-sm-3">
            <button type="button" class="btn btn-primary" id="sendPeriodBtn">发送</button>
        </div>
    </div>

    <br/>
    <hr/>
    <br/>

    <!-- 控制柜断电通电 -->
    <div class="row">
        <div class="col-sm-1">
            <label class="form-control">控制柜通断电：</label>
        </div>

        <div class="col-sm-1">
            <div class="switch switch-large">
                <input id="eleboxOnBtn" type="checkbox" checked />
            </div>
        </div>
    </div>

    <br/>
    <hr/>
    <br/>

    <!-- 开关任务策略 -->
    <div class="row">
        <div class="col-sm-1">
            <label class="form-control">开关任务1：</label>
        </div>

        <div class="col-sm-1">
            <select id="switch1TypeSelect" class="form-control">
                <option value="1">平常</option>
                <option value="2">周末</option>
                <option value="4">节假日</option>
            </select>
        </div>

        <div class="col-sm-3">
            <div class="form-group">
                <label for="dtp_input1" class="col-md-3 control-label">开始时间：</label>
                <div class="input-group date form_datetime col-md-8" data-date="1979-09-16T05:25:07Z" data-date-format="dd MM yyyy - HH:ii p" data-link-field="dtp_input1">
                    <input class="form-control" size="16" type="text" value="" readonly>
                    <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
                    <span class="input-group-addon"><span class="glyphicon glyphicon-th"></span></span>
                </div>
                <input type="hidden" id="dtp_input1" value="" /><br/>
            </div>
        </div>

        <div class="col-sm-3">
            <div class="form-group">
                <label for="dtp_input2" class="col-md-3 control-label">结束时间：</label>
                <div class="input-group date form_datetime col-md-8" data-date="1979-09-16T05:25:07Z" data-date-format="dd MM yyyy - HH:ii p" data-link-field="dtp_input2">
                    <input class="form-control" size="16" type="text" value="" readonly>
                    <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
                    <span class="input-group-addon"><span class="glyphicon glyphicon-th"></span></span>
                </div>
                <input type="hidden" id="dtp_input2" value="" /><br/>
            </div>
        </div>

        <div class="col-sm-1">
            <input id="percent1" class="form-control" type="text" />
        </div>
    </div>

    <hr />

    <div class="row">
        <div class="col-sm-1">
            <label class="form-control">开关任务2：</label>
        </div>

        <div class="col-sm-1">
            <select id="switch2TypeSelect" class="form-control">
                <option value="1">平常</option>
                <option value="2">周末</option>
                <option value="4">节假日</option>
            </select>
        </div>

        <div class="col-sm-3">
            <div class="form-group">
                <label for="dtp_input3" class="col-md-3 control-label">开始时间：</label>
                <div class="input-group date form_datetime col-md-8" data-date="1979-09-16T05:25:07Z" data-date-format="dd MM yyyy - HH:ii p" data-link-field="dtp_input3">
                    <input class="form-control" size="16" type="text" value="" readonly>
                    <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
                    <span class="input-group-addon"><span class="glyphicon glyphicon-th"></span></span>
                </div>
                <input type="hidden" id="dtp_input3" value="" /><br/>
            </div>
        </div>

        <div class="col-sm-3">
            <div class="form-group">
                <label for="dtp_input4" class="col-md-3 control-label">结束时间：</label>
                <div class="input-group date form_datetime col-md-8" data-date="1979-09-16T05:25:07Z" data-date-format="dd MM yyyy - HH:ii p" data-link-field="dtp_input4">
                    <input class="form-control" size="16" type="text" value="" readonly>
                    <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
                    <span class="input-group-addon"><span class="glyphicon glyphicon-th"></span></span>
                </div>
                <input type="hidden" id="dtp_input4" value="" /><br/>
            </div>
        </div>

        <div class="col-sm-1">
            <input id="percent2" class="form-control" type="text" />
        </div>
    </div>

    <hr />

    <div class="row">
        <div class="col-sm-2">
            <button id="sendTerminalSwitchBtn" type="button" class="btn btn-primary">发送开关任务策略命令</button>
        </div>
    </div>

    <br/>
    <hr/>
    <br/>

    <!-- 读取终端信息 -->
    <div class="row">
        <div class="col-sm-1">
            <label class="form-control">读取终端信息：</label>
        </div>

        <div class="col-sm-3">
            <button type="button" class="btn btn-primary" id="readTerminalInfo">读取终端信息</button>
        </div>

        <!--<div class="col-sm-5">
            <textarea class="form-control" id="terminalInfoTextArea" rows="3"></textarea>
        </div>-->
    </div>

    <br/>
    <hr/>
    <br/>

    <!-- 设置终端自动模式0-自动 1-手动 -->
    <div class="row">
        <div class="col-sm-1">
            <label class="form-control">终端手动模式：</label>
        </div>

        <div class="col-sm-1">
            <div class="switch switch-large">
                <input id="terminalAutoModel" type="checkbox" checked />
            </div>
        </div>
    </div>

    <br/>
    <hr/>
    <br/>

    <!-- 客户端实时消息接收 -->
    <div class="row">
        <div class="col-sm-1">
            <label class="form-control">实时消息接收：</label>
        </div>

        <div class="col-sm-8">
            <textarea class="form-control" id="netMessageTextArea" rows="8"></textarea>
        </div>
    </div>

    <br/>
    <hr/>
    <br/>
</div>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="/nnlightctl/html/js/jquery/jquery-3.3.1.min.js"></script>
<script src="/nnlightctl/html/js/bootstrap/popper.js"></script>
<script src="/nnlightctl/html/js/bootstrap/tether.min.js"></script>
<script src="/nnlightctl/html/js/bootstrap/bootstrap.min.js"></script>
<script src="/nnlightctl/html/js/bootstrap/bootstrap-switch.min.js"></script>
<script src="/nnlightctl/html/js/bootstrap/bootstrap-datetimepicker.min.js"></script>
<script src="/nnlightctl/html/js/bootstrap/bootstrap-datetimepicker.zh-CN.js"></script>
<script type="text/javascript">
    $("#sendCommand").click(function () {
        $.post("/nnlightctl/api/command/sendcommand", {"msg" : $("#comandText").val().trim()}, function (result) {
            // $("#resultText").val(result);
        }, "text");
    });

    $("#sendCommandLightAdjust").click(function() {
        $.post("/nnlightctl/api/command/sendLightAdjustCommandBatch",
            {"lightPercent" : $("#lightPercent").val().trim(), "lightIds[0]" : $("#lightId").val().trim()}, function (result) {
        });
    });

    $("#lightPercentSlide").change(function () {
        $("#lightPercent").val(this.value);
        $("#sendCommandLightAdjust").click();
    });

    //终端模块测试用函数，打开uuid为36个1的终端

    //每10秒发送打开继电器开关，如果继电器已打开则关闭该定时器
    var time = null;

    function doOpenModel() {
        $.post("/nnlightctl/api/command/sendLightAdjustCommandBatch",
            {"lightPercent" : 1, "lightIds[0]" : 201}, function (result) {

            });
    }

    function openModel() {
        time = setInterval("doOpenModel()", 10 * 1000);
    }

    function clearOpenModelInterval() {
        if (time) {
            clearInterval(time);
        }
    }

    //定时获取服务器端消息
    var timeGetMessage = setInterval(function () {
        $.post("/nnlightctl/api/command/webClientReceiveMsg", {}, function (result) {
            if (!result) {
                return;
            }
            var newMsg = result.body.data[0];
            if (!newMsg) {
                return;
            }

            //终端模块调试开始
            //1.从newMsg中获取UUID
            var uuid = newMsg.substr(newMsg.indexOf("UUID") + 5, 36);
            if (uuid == "111111111111111111111111111111111111") {
                clearOpenModelInterval();
            }
            //2.判断uuid是否为36个2
            if (uuid == "222222222222222222222222222222222222") {
                //3.关闭uuid为36个1对应的终端
                $.post("/nnlightctl/api/command/sendLightAdjustCommandBatch",
                    {"lightPercent" : 0, "lightIds[0]" : 201}, function (result) {
                        if (result) {   //判断关闭成功
                            //4.20秒之后重新打开uuid为36个1对应的终端
                            setTimeout("openModel()", 20 * 1000);
                        }
                    });
            }
            //终端模块调试结束

            var text = $("#netMessageTextArea").val();
            text += "\r\n";
            text += (new Date().toLocaleString() + "  " + newMsg);
            $("#netMessageTextArea").val(text);
        }, "json");
    }, 5000);

    //周期发送调光指令
    var value = 0;
    // var timeTestLightAdjust = setInterval(function () {
    //     $("#lightPercentSlide").val(value);
    //     $("#lightPercentSlide").change();
    //     value += 5;
    //     if (value >= 100) {
    //         value = 0;
    //     }
    // }, 5000);

    //重启复位
    $("#resetBtn").click(function () {
        $.post("/nnlightctl/api/command/resetCommand", {}, function () {

        });
    });

    //设置定时发送参数
    $("#sendPeriodBtn").click(function () {
        var period = $("#sendPeriod").val().trim();
        $.post("/nnlightctl/api/command/configTerminalSendMsgPeriod", {"terminalSendMsgPeriod" : period}, function () {
            
        });
    });

    //控制柜通断电
    $("#eleboxOnBtn").bootstrapSwitch();
    $('#eleboxOnBtn').on('switchChange.bootstrapSwitch', function (event, state) {
        console.log(state);
        $.post("/nnlightctl/api/command/commandTerminalEleboxOn", {"terminalEleboxOn" : state}, function () {

        });
    });

    //任务开关策略
    $('.form_datetime').datetimepicker({
        language:  'zh-CN',
        weekStart: 1,
        todayBtn:  1,
        autoclose: 1,
        todayHighlight: 1,
        startView: 2,
        forceParse: 0,
        showMeridian: 1,
        minuteStep : 5
    });
    $("#sendTerminalSwitchBtn").click(function () {
        var sendData = {"switch1Type" : $("#switch1TypeSelect").val(), "switch1StartDate" : $("#dtp_input1").val(),
            "switch1EndDate" : $("#dtp_input2").val(), "switch1Percent" : $("#percent1").val(),
            "switch2Type" : $("#switch2TypeSelect").val(), "switch2StartDate" : $("#dtp_input3").val(),
            "switch2EndDate" : $("#dtp_input4").val(), "switch2Percent" : $("#percent2").val()};
        $.post("/nnlightctl/api/command/testConfigTerminalSwitchPolicy", sendData, function () {

        });
    });

    //读取终端信息
    $("#readTerminalInfo").click(function () {
        $.post("/nnlightctl/api/command/commandReadTerminalInfo", {}, function (data) {
            // $("#terminalInfoTextArea").val(JSON.stringify(data));
        });
    });

    //终端自动模式
    $("#terminalAutoModel").bootstrapSwitch();
    $('#terminalAutoModel').on('switchChange.bootstrapSwitch', function (event, state) {
        console.log(state);
        var model = 0;
        if (state) {
            model = 1;
        }
        $.post("/nnlightctl/api/command/commandConfigTerminalAutModel", {"autoModel" : model}, function () {

        });
    });

</script>
</body>
</html>